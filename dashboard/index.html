<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shuma-Gorath Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes@0.5.0/dist/chartjs-plugin-colorschemes.min.js"></script>
</head>

<body>
  <div class="container">
    <header>
      <div class="shuma-image-wrapper">
        <img src="assets/shuma-gorath.png" alt="Shuma-Gorath" class="shuma-gorath-img">
      </div>
      <h1>Shuma-Gorath</h1>
      <p class="subtitle">Many-Angled Bot Defence</p>
      <div id="test-mode-banner" class="test-mode-banner hidden">TEST MODE ACTIVE - Logging only, no blocking</div>
      <span id="last-updated"></span>
    </header>

    <div class="config">
      <label for="endpoint">API Endpoint:</label>
      <input id="endpoint" value="http://127.0.0.1:3000" size="30" aria-label="API endpoint">
      <label for="apikey">API Key:</label>
      <input id="apikey" value="changeme-supersecret" size="30" type="password" aria-label="API key">
      <button id="refresh" aria-label="Refresh dashboard">Refresh</button>
    </div>

    <!-- Stats Summary Cards -->
    <div class="stats-cards">
      <div class="card">
        <h3>Total Bans</h3>
        <div class="stat-value" id="total-bans">-</div>
      </div>
      <div class="card">
        <h3>Active Bans</h3>
        <div class="stat-value" id="active-bans">-</div>
      </div>
      <div class="card">
        <h3>Events (24h)</h3>
        <div class="stat-value" id="total-events">-</div>
      </div>
      <div class="card">
        <h3>Unique IPs</h3>
        <div class="stat-value" id="unique-ips">-</div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
      <div class="chart-container">
        <h2>Event Types (24h)</h2>
        <canvas id="eventTypesChart"></canvas>
      </div>
      <div class="chart-container">
        <h2>Top 10 IPs by Events</h2>
        <canvas id="topIpsChart"></canvas>
      </div>
    </div>

    <!-- Events Over Time -->
    <div class="section">
      <div class="chart-header">
        <h2>Events Over Time</h2>
        <div class="time-range-buttons">
          <button class="time-btn active" data-range="hour">60 Mins</button>
          <button class="time-btn" data-range="day">24 Hours</button>
          <button class="time-btn" data-range="week">7 Days</button>
          <button class="time-btn" data-range="month">30 Days</button>
        </div>
      </div>
      <div class="chart-container">
        <canvas id="timeSeriesChart"></canvas>
      </div>
    </div>

    <!-- Ban List -->
    <div class="section">
      <h2>Current Bans</h2>
      <table id="bans-table">
        <thead>
          <tr>
            <th>IP Address</th>
            <th>Reason</th>
            <th>Banned At</th>
            <th>Expires</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Maze Activity Section -->
    <div class="section maze-section">
      <h2>Link Maze Honeypot</h2>
      <p class="section-desc">Crawlers trapped in infinite fake pages</p>
      <div class="maze-stats">
        <div class="maze-stat">
          <span class="maze-label">Total Hits</span>
          <span class="maze-value" id="maze-total-hits">-</span>
        </div>
        <div class="maze-stat">
          <span class="maze-label">Unique Crawlers</span>
          <span class="maze-value" id="maze-unique-crawlers">-</span>
        </div>
        <div class="maze-stat">
          <span class="maze-label">Auto-Banned</span>
          <span class="maze-value" id="maze-auto-bans">-</span>
        </div>
      </div>
      <div class="maze-crawlers">
        <h3>Top Crawlers in Maze</h3>
        <div class="crawler-list" id="maze-crawler-list">
          <p class="no-data">No crawlers in maze yet</p>
        </div>
      </div>
    </div>

    <!-- Admin Controls -->
    <div class="section admin-controls">
    <h2>Admin Controls</h2>
      <div class="controls-grid">
        <div class="control-group">
          <h3>Test Mode</h3>
          <p class="control-desc">When enabled, logs actions without blocking users</p>
          <label class="toggle-switch" for="test-mode-toggle">
            <input type="checkbox" id="test-mode-toggle" aria-label="Enable Test Mode">
            <span class="toggle-slider"></span>
          </label>
          <span id="test-mode-status">Loading...</span>
        </div>
        <div class="control-group">
          <h3>Ban Durations</h3>
          <p class="control-desc">Configure ban duration per offense type (seconds)</p>
          <div class="duration-grid">
            <label for="dur-honeypot">Honeypot:</label> <input id="dur-honeypot" type="number" value="86400" />
            <label for="dur-rate-limit">Rate Limit:</label> <input id="dur-rate-limit" type="number" value="3600" />
            <label for="dur-browser">Browser:</label> <input id="dur-browser" type="number" value="21600" />
            <label for="dur-admin">Admin:</label> <input id="dur-admin" type="number" value="21600" />
          </div>
          <button id="save-durations-btn">Save Durations</button>
        </div>
        <div class="control-group">
          <h3>Ban IP</h3>
          <input id="ban-ip" type="text" placeholder="IP address" aria-label="IP address to ban" />
          <input id="ban-reason" type="text" placeholder="Reason (optional)" value="manual_ban" aria-label="Ban reason" />
          <input id="ban-duration" type="number" placeholder="Duration (seconds)" value="3600" aria-label="Ban duration in seconds" />
          <button id="ban-btn">Ban</button>
        </div>
        <div class="control-group">
          <h3>Unban IP</h3>
          <input id="unban-ip" type="text" placeholder="IP address" aria-label="IP address to unban" />
          <button id="unban-btn">Unban</button>
        </div>
        <div class="control-group">
          <h3>Link Maze</h3>
          <p class="control-desc">Honeypot trap for crawlers</p>
          <div class="admin-controls">
            <div class="toggle-row">
              <label class="control-label" for="maze-enabled-toggle">Maze Enabled</label>
              <label class="toggle-switch">
                <input type="checkbox" id="maze-enabled-toggle" checked aria-label="Enable maze honeypot">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="toggle-row">
              <label class="control-label" for="maze-auto-ban-toggle">Auto-Ban</label>
              <label class="toggle-switch">
                <input type="checkbox" id="maze-auto-ban-toggle" checked aria-label="Enable maze auto-ban">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="input-row">
              <label class="control-label" for="maze-threshold">Ban Threshold</label>
              <input type="number" id="maze-threshold" value="50" min="5" max="500" aria-label="Maze ban threshold in pages">
              <span class="input-unit">pages</span>
            </div>
          </div>
          <button id="save-maze-config">Save Maze Settings</button>
        </div>
        <div class="control-group">
          <h3>AI Training Opt-Out Policy</h3>
          <p class="control-desc">Declare crawling policies via robots.txt (advisory, not enforcement)</p>
          <div class="admin-controls">
            <div class="toggle-row">
              <label class="control-label control-label--wide" for="robots-enabled-toggle">Serve robots.txt</label>
              <label class="toggle-switch">
                <input type="checkbox" id="robots-enabled-toggle" checked aria-label="Serve robots.txt">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="toggle-row">
              <label class="control-label control-label--wide" for="robots-block-training-toggle">Opt-out AI Training</label>
              <label class="toggle-switch">
                <input type="checkbox" id="robots-block-training-toggle" checked aria-label="Opt-out AI training">
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-hint">GPTBot, CCBot, ClaudeBot</span>
            </div>
            <div class="toggle-row">
              <label class="control-label control-label--wide" for="robots-block-search-toggle">Opt-out AI Search</label>
              <label class="toggle-switch">
                <input type="checkbox" id="robots-block-search-toggle" aria-label="Opt-out AI search">
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-hint">PerplexityBot, etc.</span>
            </div>
            <div class="toggle-row">
              <label class="control-label control-label--wide" for="robots-allow-search-toggle">Restrict Search Engines</label>
              <label class="toggle-switch">
                <input type="checkbox" id="robots-allow-search-toggle" aria-label="Restrict search engines">
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-hint">Google, Bing, etc.</span>
            </div>
            <div class="input-row">
              <label class="control-label control-label--wide" for="robots-crawl-delay">Crawl Delay</label>
              <input type="number" id="robots-crawl-delay" value="2" min="0" max="60" aria-label="Robots crawl delay in seconds">
              <span class="input-unit">seconds</span>
            </div>
          </div>
          <button id="save-robots-config" disabled>Update Policy</button>
          <button id="preview-robots">Show robots.txt</button>
          <div id="robots-preview" class="robots-preview hidden">
            <h4>robots.txt Preview</h4>
            <pre id="robots-preview-content"></pre>
          </div>
        </div>
        <div class="control-group">
          <h3>CDP (Detect Browser Automation)</h3>
          <p class="control-desc">Detects bots controlling browsers on behalf of human users (Puppeteer, Playwright,
            Selenium, etc.)</p>
          <div class="admin-controls">
            <div class="toggle-row">
              <label class="control-label control-label--wide" for="cdp-enabled-toggle">Enable Detection</label>
              <label class="toggle-switch">
                <input type="checkbox" id="cdp-enabled-toggle" checked aria-label="Enable CDP detection">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="toggle-row">
              <label class="control-label control-label--wide" for="cdp-auto-ban-toggle">Auto-ban on Detection</label>
              <label class="toggle-switch">
                <input type="checkbox" id="cdp-auto-ban-toggle" checked aria-label="Enable CDP auto-ban">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="slider-control">
              <div class="slider-header">
                <label class="control-label control-label--wide" for="cdp-threshold-slider">Detection Threshold</label>
                <span id="cdp-threshold-value" class="slider-badge">0.6</span>
              </div>
              <input type="range" id="cdp-threshold-slider" min="0.3" max="1.0" step="0.1" value="0.6" aria-label="CDP detection threshold">
              <div class="slider-labels">
                <span>Sensitive</span>
                <span>Strict</span>
              </div>
            </div>
          </div>
          <button id="save-cdp-config" disabled>Save CDP Settings</button>
          <div id="cdp-stats" class="info-panel">
            <h4>Detection Stats</h4>
            <div class="info-row">
              <span class="info-label">Total Detections:</span>
              <span id="cdp-total-detections">0</span>
            </div>
            <div class="info-row">
              <span class="info-label">Auto-bans:</span>
              <span id="cdp-auto-bans">0</span>
            </div>
          </div>
        </div>
      </div>
      <div id="admin-msg" class="message"></div>
    </div>

    <!-- Recent Events -->
    <div class="section events">
      <h2>Recent Events (Last 100)</h2>
      <div class="table-wrapper">
        <table id="events">
          <thead>
            <tr>
              <th>Time</th>
              <th>Type</th>
              <th>IP</th>
              <th>Reason</th>
              <th>Outcome</th>
              <th>Admin</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

  </div>
  <script src="dashboard.js"></script>
  <script src="admin.js"></script>
</body>

</html>